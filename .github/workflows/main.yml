name: Deploy Backend

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: self-hosted   # ‚Üê utiliser ton runner self-hosted
    steps:
      # 1Ô∏è‚É£ R√©cup√©rer le code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2Ô∏è‚É£ Installer pnpm
      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      # 3Ô∏è‚É£ Build et d√©ploiement
      - name: Build & Deploy Backend
        run: |
          cd /home/safidy/mnp-webmapping/backend
          git fetch
          git reset --hard origin/main
          pnpm install
          pnpm run migration:run
          pnpm run seed
          pnpm run build
          pm2 reload webmapping-backend
          echo "Backend d√©ploy√© avec succ√®s ! üöÄ"

