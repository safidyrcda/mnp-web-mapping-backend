name: Deploy Backend

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: self-hosted   # â† utiliser ton runner self-hosted
    steps:
      # 1ï¸âƒ£ RÃ©cupÃ©rer le code
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2ï¸âƒ£ Installer pnpm
      - name: Setup pnpm
        uses: pnpm/action-setup@v2
        with:
          version: 8

      # 3ï¸âƒ£ Build et dÃ©ploiement
      - name: Build & Deploy Backend
        run: |
          cd /home/mnp-webmapping/backend
          git fetch
          git reset --hard origin/main
          pnpm install
          pnpm run migration:generate
          pnpm run migration:run
          pnpm run build
          pm2 reload webmapping-backend
          echo "Backend dÃ©ployÃ© avec succÃ¨s ! ğŸš€"

